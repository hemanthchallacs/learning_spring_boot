package com.elearning.spring.controllers;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.ModelAttribute;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestMethod;
import org.springframework.web.servlet.ModelAndView;

import com.elearning.spring.entities.User;
import com.elearning.spring.repo.AdminRepository;

public class AdminController {

	@Autowired
	private AdminRepository adminRepo;
	
	@RequestMapping(value = "/adminlogin", method = RequestMethod.GET)	
	public ModelAndView getloginForm() {
		
		ModelAndView mav = new ModelAndView("adminlogin");
		mav.addObject("loginuser", new Admin());
		return mav;
		
	}
	
	@RequestMapping(value = "/loginUser", method = RequestMethod.POST)
	public String loginUser(@ModelAttribute User loginuser) {
		
		
		try {
			User retUser = userRepo.findById(loginuser.getUser_id()).get();
			
			System.out.println(loginuser.getUser_id());
			System.out.println(loginuser.getPassword());
			if(retUser.getPassword().equals(loginuser.getPassword()))
			{	CoreController.setCurruser(loginuser);
				return "redirect:/courseList";
			}
			else
				return "welcome";
		}
		catch(Exception e)
		{
			System.out.println("Couldnt login");
			return "welcome";
		}
		
	}

}
